'use strict';

app
.controller('ManagerController', function ($scope, $stateParams,$filter, Manager ,Objectif,Bap) {


	$scope.managers = Manager.query();
        // id récupérer à partir de la session ouverte 

        Manager.get({id: 151}, function(result) {
        	$scope.manager = result;
            //collaborateur du managerRH avec un BAp statut en cours
            $scope.collaborateurs = $scope.manager.collaborateurs;        
            console.log($scope.collaborateurs);
            console.log(Bap.get({id:1}));
            //creation  bap 




        });  
        
        $scope.initBap=function  () {
        	var newbaps= [];
        	$scope.collaborateursBap=getCheckedRows();
        	console.log("init Bap....")
        	console.log($scope.collaborateursBap);
        	$scope.collaborateursBap.forEach(function (entity) {
        		entity.ficheobjectifsc = Objectif.currentfiche({id:entity.id}) ;

        		var newbap ={};
        		newbap.ficheObjectifsTraites={};
        		newbap.ficheObjectifsTraites =entity.ficheobjectifsc ;
        		newbap.statut = "EN_ATTENTE";
        		newbap.dateBilan=$filter('date')("2015/11/21", 'yyyy-MM-dd');    
        		newbap.feedbacks=[];
        		newbap.ficheEvaluations={};
        		newbap.ficheObjectifsRediges={};
        		newbap.ficheObjectifsRediges.autorisationAcces= true;
        		newbap.ficheObjectifsRediges.dateFicheObjectifs=$filter('date')("2015/11/21", 'yyyy-MM-dd');    
        		newbap.ficheObjectifsRediges.objectifs=[];
        		newbap.collaborateur =entity;
        		newbaps.push(newbap);
        	});
        	$scope.newbaps= newbaps;
        	console.log(newbaps);
        	console.log($scope.collaborateursBap[0].ficheobjectifsc);
        	// Creation du Bap
        	$scope.current = 1;
        	$('#step2').hide();	
        	$('#step3').hide();	
        	$('#BapModal').modal('show');
        	
        }

        $scope.valider=function  (o,i) {
        // $('#objectif'+o.id).hide();
        $('#objectif'+o.id).html("objectif Validé");
    }

    $scope.reporter=function  (o , i) {

    	
    	$scope.newbaps[i].ficheObjectifsRediges.objectifs.push(o);

    	console.log($scope.newbaps);
    }

    $scope.nextStep=function()
    {

    	$('#step'+$scope.current).hide();
    	$scope.current++;
    	$('#step'+$scope.current).show();
        	// if($scope.current==3)$('#nextbtn').hide();	
        }
        function getCheckedRows () {
        	return $scope.collaborateurs.filter(function (entity) { return entity.checked;});
        }

        function getCheckedRowsIDs () {
        	return getCheckedRows().map(function(entity){return entity.id;});
        }
    });

